<!DOCTYPE html>
<html>
    <head>
        <title>Task Tracker</title>
        <link rel="stylesheet" type="text/css" href="css/materialize.min.css" media="screen,projection" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <style type="text/css">
            body {
                background-color: teal;
            }

            button {
                width: 49%;
            }

            #superset {
                margin-top: calc(50vh - 324px/2);
            }
        </style>
    </head>

    <body>
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/materialize.min.js"></script>

        <script type="text/javascript">
            "use strict";

            function validate() {
                if (username.value === "") return;
                $.ajax({
                    url: "php/username.php",
                    data: {"username": username.value},
                    success: function (user_exists) {
                        $("#username").removeClass(login.checked == user_exists ? "invalid" : "valid");
                        $("#username").addClass(login.checked == user_exists ? "valid" : "invalid");
                        if (login.checked == user_exists)
                            $("[name='action']").removeClass("disabled");
                        else
                            $("[name='action']").addClass("disabled");
                    }
                });
            }

            function onLoginTypeChange() {
                $("[name='action']").html(login.checked ? "Login" : "Sign Up");
                $("[for='username']").attr("data-error", login.checked ? "Incorrect" : "Exists");
                $("[for='username']").attr("data-success", login.checked ? "Enter Password" : "Available");
                username.focus(); /* manual focus and blur needed to force repaint */
                username.blur();
            }

            function onCancel() {
                setTimeout(function () {
                    onLoginTypeChange();
                    $("[name='action']").addClass("disabled");
                    password.focus();
                    password.blur();
                    login.click();
                }, 200);
            }

            $(function () {
                login.setAttribute("onclick", "onLoginTypeChange()");
                signup.setAttribute("onclick", "onLoginTypeChange()");
                username.setAttribute("onblur", "validate()");
                $("[type='reset']").attr("onclick", "onCancel()");
                $("[name='action']").addClass("disabled");
                login.click();
            });
        </script>

        <div id="superset" class="row">
            <div class="col m3 s1"></div>
            <form class="card-panel col m6 s10">
                <div class="row">
                    <div class="input-field col s12">
                        <input id="username" type="text" class="validate" />
                        <label for="username">Username</label>
                    </div>
                </div>

                <div class="row">
                    <div class="input-field col s12">
                        <input id="password" type="password" class="validate" />
                        <label for="password">Password</label>
                    </div>
                </div>

                <div class="row">
                    <div class="col s12">
                        <input id="login" name="login" value="true" type="radio" />
                        <label for="login">Login</label>

                        &nbsp;&nbsp;&nbsp;&nbsp;

                        <input id="signup" name="login" value="false" type="radio" />
                        <label for="signup">Sign Up</label>
                    </div>
                </div>

                <div class="row">
                    <div class="col s12">
                        <button class="btn waves-effect waves-light btn-large" type="submit" name="action"></button>
                        <button class="btn waves-effect waves-light btn-large" type="reset">Cancel</button>
                    </div>
                </div>
            </form>
        </div>
    </body>
</html>
